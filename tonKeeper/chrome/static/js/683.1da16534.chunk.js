"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[683],{83683:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Rs});var s=t(30168),r=t(80184),i=t(47712),o=t(11707),a=t(72791),l=t(57689),d=t(65867),c=t(29305),p=t(41235);var u=t(87594),m=t(94216),h=t(34692),x=t(23098),g=t(86445);const v=1,f=.3,j=()=>{const e=(0,x._H)();return(0,p.useQuery)([g.l.SWAP_OPTIONS],(async()=>{const n=await e.storage.get(g.l.SWAP_OPTIONS);return{slippagePercent:(null===n||void 0===n?void 0:n.slippagePercent)||v,maxPriceImpact:(null===n||void 0===n?void 0:n.maxPriceImpact)||f}}))};const w=e=>"stonfi"===e.provider?{provider:"stonfi",stonfiTrade:e.trade.rawTrade}:"dedust"===e.provider?{provider:"dedust",dedustTrade:e.trade.rawTrade}:void function(e){throw new Error("Didn't expect to get here")}();var y=t(53006),b=t(35976),A=t(5784),S=t(22245),k=t(88674),C=t(88754),_=t(93853),z=t(48544),Z=t(76978),T=t(97284),O=t(1849),P=t(39079),E=t(14182),N=t(9356),F=t(97957),D=t(72119);const R=new Map,M=["stonfi","dedust"],B=(0,D.cn)([]);let I=0;function K(){const{api:e}=(0,u.bp)(),[n,t]=(0,D.KO)(B),[s]=(0,y.g7)(),[r]=(0,y.dN)(),[i]=(0,y.y)(),[o,l]=(0,y.K4)(),d=(0,y.RM)(),{swapService:c}=(0,m.W)(),h=(0,p.useQuery)({queryKey:[F.S8.swapCalculate,s.id,r.id,null===i||void 0===i?void 0:i.shiftedBy(s.decimals).toFixed(0)],queryFn:async n=>{let{signal:o}=n;t([]),l(void 0),I+=1;const a=I;if(d)return[];J(s),J(r);const p=(0,_.$O)(i,s.decimals);let u=[];return new Promise(((n,i)=>{let d=0;M.forEach((async m=>{try{const h=c.calculateSwap(U(s.address),U(r.address),p.toFixed(0),m);o&&(o.onabort=()=>h.cancel());const x=await h,g=await $(x,e,s,r);if(a!==I)return void i(new Error("Calculation cancelled"));const v=L(g)[0];u=L(u.concat(v)),u[0].trade&&l(u[0]),t((e=>L([...e,v]))),d+=1,d===M.length&&n(u)}catch(h){if(a!==I)return void i(new Error("Calculation cancelled"));console.error(h);const e={provider:m,trade:null};u=L(u.concat(e)),u[0].trade&&l(u[0]),t((n=>L([...n,e]))),d+=1,d===M.length&&n(u)}}))}))},cacheTime:0});return(0,a.useMemo)((()=>({...h,fetchedSwaps:n})),[h,n])}const U=e=>(0,z.kC)(e)?"ton":e.toRawString(),W=e=>"ton"===e?"TON":o.Address.parse(e),L=e=>e.slice().sort(((e,n)=>e.trade?n.trade?n.trade.to.weiAmount.comparedTo(e.trade.to.weiAmount):-1:1)),$=async(e,n,t,s)=>{const r=await q(e.trades,n);if("dedust"===e.provider)return 0===e.trades.length?[{provider:"dedust",trade:null}]:e.trades.map((e=>({provider:"dedust",trade:{from:new Z.n({asset:t,weiAmount:e.fromAmount}),to:new Z.n({asset:s,weiAmount:e.toAmount}),path:e.path.map((e=>r.find((n=>(0,N.A)(n.address,W(e)))))),blockchainFee:new Z.n({asset:O.Ct,weiAmount:e.blockchainFee}),rawTrade:e.dedustRawTrade}})));if("stonfi"===e.provider){const n=e.trades[0];return n?[{provider:"stonfi",trade:{from:new Z.n({asset:t,weiAmount:n.fromAmount}),to:new Z.n({asset:s,weiAmount:n.toAmount}),blockchainFee:new Z.n({asset:O.Ct,weiAmount:n.blockchainFee}),rawTrade:n.stonfiRawTrade,path:n.path.map((e=>r.find((n=>(0,N.A)(n.address,W(e))))))}}]:[{provider:"stonfi",trade:null}]}return[]},q=async(e,n)=>{const t=e.flatMap((e=>e.path.map(W)));return Promise.all(t.map((e=>Q(n,e))))},J=e=>{R.has(e.address)||R.set(e.address,Promise.resolve(e))},Q=async(e,n)=>{if((0,z.kC)(n))return O.Ct;if(R.has(n))return R.get(n);const t=new T.EkG(e.tonApiV2).getJettonInfo({accountId:n.toRawString()}).then((e=>({symbol:e.metadata.symbol,decimals:Number(e.metadata.decimals),name:e.metadata.name,blockchain:E.S.TON,address:n,id:(0,P.G)(E.S.TON,n),image:e.metadata.image})));return R.set(n,t),t};var G=t(29681),H=t(61945);const Y=e=>{let{onClick:n,isEncodingProcess:t}=e;const{t:s}=(0,H.$)(),[i]=(0,y.y)(),[o]=(0,y.g7)(),{data:a}=(0,y.Fu)(),{isFetching:l,data:d}=K(),[c]=(0,y.K4)(),p=(0,y.MT)(),{data:u}=j(),m=(0,y.RM)();if((0,G.vO)())return(0,r.jsx)(C.zx,{size:"medium",secondary:!0,disabled:!0,children:s("swap_ledger_not_supported")});if(m)return(0,r.jsx)(C.zx,{size:"medium",secondary:!0,disabled:!0,children:s("swap_enter_amount")});if(!l&&null!==d&&void 0!==d&&d.every((e=>!e.trade)))return(0,r.jsx)(C.zx,{size:"medium",disabled:!0,children:s("swap_trade_is_not_available")});if(l&&(null===c||void 0===c||!c.trade)||!a||void 0===p||!u)return(0,r.jsx)(C.zx,{size:"medium",secondary:!0,loading:!0,children:s("continue")});if(!c||!c.trade)return(0,r.jsx)(C.zx,{size:"medium",secondary:!0,disabled:!0,children:s("swap_trade_is_not_available")});if(null===i||void 0===i?void 0:i.gt((0,_.PE)(a,o.decimals)))return(0,r.jsx)(C.zx,{size:"medium",secondary:!0,disabled:!0,children:s("swap_not_enough_funds")});return(null===p||void 0===p?void 0:p.gt(u.maxPriceImpact))?(0,r.jsx)(C.zx,{size:"medium",secondary:!0,disabled:!0,children:s("swap_price_impact_too_high")}):(0,r.jsx)(C.zx,{size:"medium",primary:!0,onClick:n,loading:t,children:s("continue")})};var V=t(47578),X=t(20504),ee=t(90820);const ne=(0,a.forwardRef)(((e,n)=>{let{className:t,isDisabled:s}=e;const{t:i}=(0,H.$)(),[o,a]=(0,X.L)();return(0,r.jsx)(ee.II,{value:o,onChange:e=>a(e),ref:n,disabled:s,label:i("swap_search"),clearButton:!0,className:t,size:"small"})}));var te,se,re,ie,oe=t(61819);const ae=d.zo.div(te||(te=(0,s.Z)(["\n    display: flex;\n    flex-direction: column;\n    text-align: center;\n"]))),le=(0,d.zo)(i.pN)(se||(se=(0,s.Z)(["\n    display: block;\n    margin-top: 4px;\n    color: ",";\n"])),(e=>e.theme.textSecondary)),de=d.zo.div(re||(re=(0,s.Z)(["\n    width: 100%;\n    display: flex;\n    gap: 8px;\n    margin-top: 24px;\n\n    > * {\n        flex: 1;\n    }\n"]))),ce=(0,d.vJ)(ie||(ie=(0,s.Z)(["\n      .confirm-import-swap-token-notification {\n        ","\n      }\n    "])),(e=>"full-width"===e.theme.displayType&&"max-width: 400px;")),pe=e=>{let{isOpen:n,onClose:t,tokenSymbol:s}=e;const{t:o}=(0,H.$)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ce,{}),(0,r.jsx)(V.P_,{isOpen:n,handleClose:t,wrapperClassName:"confirm-import-swap-token-notification",children:()=>(0,r.jsxs)(ae,{children:[(0,r.jsx)(i.fA,{children:o("swap_import_token_title").replace("%token%",s)}),(0,r.jsx)(le,{children:o("swap_unknown_token_description")}),(0,r.jsxs)(de,{children:[(0,r.jsx)(C.zx,{primary:!0,onClick:()=>t(!1),children:o("cancel")}),(0,r.jsx)(C.zx,{secondary:!0,onClick:()=>t(!0),children:o("swap_import")})]})]})})]})};var ue,me,he,xe,ge,ve,fe,je,we,ye,be=t(20220);const Ae=d.zo.div(ue||(ue=(0,s.Z)(["\n    overflow-y: auto;\n    width: calc(100% + 2rem);\n    margin: 0 -1rem;\n    height: calc(100% - 54px);\n\n    &::-webkit-scrollbar {\n        display: none;\n    }\n\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n"]))),Se=d.zo.div(me||(me=(0,s.Z)(["\n    width: 100%;\n    height: 1px;\n    background-color: ",";\n"])),(e=>e.theme.separatorCommon)),ke=e=>{let{walletSwapAssets:n,onSelect:t}=e;const[s,i]=(0,a.useState)(n.slice(0,25)),o=(0,a.useRef)(null);(0,a.useEffect)((()=>{i(n.slice(0,25))}),[n]);return(0,r.jsx)(Ae,{ref:o,onScroll:(0,be.P2)((()=>{if(null===o||void 0===o||!o.current)return;o.current.scrollHeight-o.current.clientHeight-o.current.scrollTop<300&&i((e=>n.slice(0,e.length+25)))}),100),children:n.length?s.map(((e,s)=>(0,r.jsxs)(a.Fragment,{children:[(0,r.jsx)(Fe,{onClick:()=>t(e.assetAmount.asset),swapAsset:e}),s!==n.length-1&&(0,r.jsx)(Se,{})]},e.assetAmount.asset.id))):(0,r.jsx)(_e,{onSelect:t})})},Ce=d.zo.div(he||(he=(0,s.Z)(["\n    height: 100%;\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: ",";\n"])),(e=>e.theme.textSecondary)),_e=e=>{let{onSelect:n}=e;const{t:t}=(0,H.$)(),{data:s,isFetching:o}=(0,X.UE)(),[l,d]=(0,a.useState)(!1),{mutate:c}=(0,X.bB)();if(o)return(0,r.jsx)(Ce,{children:(0,r.jsx)(A.L4,{})});if(!s)return(0,r.jsx)(Ce,{children:(0,r.jsx)(i.pN,{children:t("swap_tokens_not_found")})});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(pe,{isOpen:l,onClose:e=>{d(!1),e&&(c(s.assetAmount.asset),n(s.assetAmount.asset))},tokenSymbol:s.assetAmount.asset.symbol}),(0,r.jsx)(Fe,{onClick:()=>d(!0),swapAsset:s})]})},ze=d.zo.button(xe||(xe=(0,s.Z)(["\n    border: none;\n    width: 100%;\n    padding: 8px 1rem;\n    display: flex;\n    gap: 12px;\n    background-color: transparent;\n\n    transition: background-color 0.15s ease-in-out;\n    cursor: pointer;\n\n    &:hover,\n    &:focus {\n        background-color: ",";\n    }\n"])),(e=>e.theme.backgroundContent)),Ze=d.zo.img(ge||(ge=(0,s.Z)(["\n    height: 40px;\n    width: 40px;\n    border-radius: 100%;\n"]))),Te=d.zo.div(ve||(ve=(0,s.Z)(["\n    display: flex;\n    flex-direction: column;\n    width: calc(100% - 52px);\n"]))),Oe=d.zo.div(fe||(fe=(0,s.Z)(["\n    display: flex;\n    align-items: center;\n    gap: 4px;\n\n    > *:first-child {\n        display: block;\n        overflow: hidden;\n        text-overflow: ellipsis;\n    }\n\n    > *:nth-child(3) {\n        margin-left: auto;\n    }\n"]))),Pe=d.zo.div(je||(je=(0,s.Z)(["\n    cursor: pointer;\n    &:hover {\n        > svg {\n            color: ",";\n        }\n    }\n"])),(e=>e.theme.iconSecondary)),Ee=(0,d.zo)(Oe)(we||(we=(0,s.Z)(["\n    color: ",";\n\n    > *:nth-child(2) {\n        margin-left: auto;\n    }\n"])),(e=>e.theme.textSecondary)),Ne=(0,d.zo)(i.fA)(ye||(ye=(0,s.Z)(["\n    color: ",";\n"])),(e=>e.isZero?e.theme.textTertiary:e.theme.textPrimary)),Fe=e=>{let{swapAsset:n,onClick:t}=e;const s=n.assetAmount.relativeAmount.isZero(),{fiat:o}=(0,u.bp)(),a=(0,x._H)();return(0,r.jsxs)(ze,{onClick:t,children:[(0,r.jsx)(Ze,{src:n.assetAmount.asset.image}),(0,r.jsxs)(Te,{children:[(0,r.jsxs)(Oe,{children:[(0,r.jsx)(i.fA,{children:n.assetAmount.asset.symbol}),(0,r.jsx)(Pe,{onClick:e=>{let t;e.preventDefault(),e.stopPropagation(),t=(0,z.kC)(n.assetAmount.asset.address)?"https://tonviewer.com/price":"https://tonviewer.com/".concat(n.assetAmount.asset.address.toString({urlSafe:!0})),a.openPage(t)},children:(0,r.jsx)(A.AT,{})}),(0,r.jsx)(Ne,{isZero:s,children:n.assetAmount.stringRelativeAmount})]}),(0,r.jsxs)(Ee,{children:[(0,r.jsx)(i.De,{children:n.assetAmount.asset.name}),!s&&(0,r.jsx)(i.De,{children:(0,oe.hE)(o,n.fiatAmount)})]})]})]})};var De,Re,Me,Be,Ie,Ke,Ue;const We=(0,D.cn)(void 0),Le=(0,d.vJ)(De||(De=(0,s.Z)(["\n  .tokens-list-notification-wrapper .dialog-content {\n    padding-bottom: 0;\n  }\n"]))),$e=()=>{const{t:e}=(0,H.$)(),[n,t]=(0,D.KO)(We),s=e=>{null===n||void 0===n||n.onClose(e),t(void 0)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Le,{}),(0,r.jsx)(V.P_,{isOpen:!!n,handleClose:()=>s(void 0),title:e("swap_tokens"),footer:(0,r.jsx)("div",{}),wrapperClassName:"tokens-list-notification-wrapper",children:()=>(0,r.jsx)(He,{onSelect:s})})]})},qe=(0,d.zo)(ne)(Re||(Re=(0,s.Z)(["\n    margin-bottom: 1rem;\n"]))),Je=d.zo.div(Me||(Me=(0,s.Z)(["\n    ","\n"])),(e=>"full-width"===e.theme.displayType?(0,d.iv)(Be||(Be=(0,s.Z)(["\n                  height: 580px;\n              "]))):(0,d.iv)(Ie||(Ie=(0,s.Z)(["\n                  height: calc(var(--app-height) - 6rem);\n              "]))))),Qe=d.zo.div(Ke||(Ke=(0,s.Z)(["\n    width: calc(100% + 2rem);\n    margin: 0 -1rem;\n    height: 1px;\n    background-color: ",";\n"])),(e=>e.theme.separatorCommon)),Ge=d.zo.div(Ue||(Ue=(0,s.Z)(["\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 300px;\n"]))),He=e=>{let{onSelect:n}=e;const t=(0,X.r7)(),s=(0,a.useRef)(),[i,o]=(0,X.L)();return(0,a.useEffect)((()=>(setTimeout((()=>{var e;return null===s||void 0===s||null===(e=s.current)||void 0===e?void 0:e.focus()}),100),()=>o(""))),[]),(0,r.jsxs)(Je,{children:[(0,r.jsx)(qe,{ref:s,isDisabled:!t}),(0,r.jsx)(Qe,{}),t?(0,r.jsx)(ke,{onSelect:n,walletSwapAssets:t}):(0,r.jsx)(Ge,{children:(0,r.jsx)(A.L4,{})})]})};var Ye,Ve,Xe;const en=(0,d.zo)(i.fA)(Ye||(Ye=(0,s.Z)(["\n    display: block;\n    max-width: 80px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    flex-shrink: 0;\n    color: ",";\n\n    transition: color 0.15s ease-in-out;\n"])),(e=>e.theme.textPrimary)),nn=d.zo.button(Ve||(Ve=(0,s.Z)(["\n    border: none;\n    display: flex;\n    align-items: center;\n    background: none;\n    padding: 0;\n    cursor: pointer;\n    gap: 6px;\n    height: 36px;\n    width: fit-content;\n\n    &:hover {\n        > "," {\n            color: ",";\n        }\n    }\n"])),en,(e=>e.theme.textSecondary)),tn=d.zo.img(Xe||(Xe=(0,s.Z)(["\n    height: 24px;\n    width: 24px;\n    border-radius: 100%;\n    flex-shrink: 0;\n"]))),sn=e=>{let{token:n,onTokenChange:t,className:s}=e;const i=(e=>{const[n,t]=(0,D.KO)(We);return(0,a.useCallback)((()=>t((()=>({onClose:e})))),[t,e])})((0,a.useCallback)((e=>e&&t(e)),[t]));return(0,r.jsxs)(nn,{className:s,onClick:i,children:[(0,r.jsx)(tn,{src:n.image}),(0,r.jsx)(en,{children:n.symbol}),(0,r.jsx)(A.UR,{})]})};var rn,on=t(27494),an=t(12850),ln=t(144);const dn=d.zo.input(rn||(rn=(0,s.Z)(["\n    border: none;\n    background: none;\n    text-align: right;\n    outline: none;\n    width: 30px;\n    color: ",";\n    font-family: inherit;\n\n    ","\n\n    &::placeholder {\n        color: ",";\n    }\n"])),(e=>e.isErrored?e.theme.accentRed:e.theme.textPrimary),i.Dv,(e=>e.theme.textTertiary));var cn,pn=t(57443),un=t(46320);const mn=(0,d.zo)(i.De)(cn||(cn=(0,s.Z)(["\n    color: ",";\n    cursor: default;\n"])),(e=>e.theme.textSecondary)),hn=e=>{let{amount:n,asset:t}=e;const{fiat:s}=(0,u.bp)(),{data:i,isLoading:o}=(0,pn.UJ)((0,z.J)(t.address));if(!n)return(0,r.jsx)("div",{});if(!o&&(null===i||void 0===i||!i.prices))return(0,r.jsx)("div",{});if(o)return(0,r.jsx)(un.Od,{width:"80px",height:"12px",margin:"2px 0"});const a=(0,oe.hE)(s,new h.Z(i.prices).multipliedBy(n));return(0,r.jsxs)(mn,{children:["\u2248\xa0",a]})};var xn,gn,vn,fn=t(60793);const jn=(0,d.zo)(i.De)(xn||(xn=(0,s.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),wn=d.zo.div(gn||(gn=(0,s.Z)(["\n    display: flex;\n    height: 16px;\n    align-items: center;\n"]))),yn=d.zo.button(vn||(vn=(0,s.Z)(["\n    border: none;\n    background: none;\n    color: ",";\n    height: fit-content;\n    margin-left: 0.5rem;\n\n    > * {\n        display: block;\n        height: fit-content;\n    }\n\n    &:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n    }\n"])),(e=>e.theme.accentBlue)),bn=()=>{const[e,n]=(0,y.y)(),[t]=(0,y.g7)(),{data:s}=(0,y.Fu)();return(0,r.jsx)(Sn,{balance:s,decimals:t.decimals,onMax:()=>n((0,_.PE)(s,t.decimals))})},An=()=>{const[e]=(0,y.dN)(),n=(0,fn.h)({address:e.address,blockchain:E.S.TON});return(0,r.jsx)(Sn,{balance:n,decimals:e.decimals})},Sn=e=>{let{balance:n,decimals:t=0,onMax:s}=e;const{t:o}=(0,H.$)(),a=(0,oe.rs)();return(0,r.jsxs)(wn,{children:[(0,r.jsxs)(jn,{children:[o("swap_balance"),":\xa0"]}),n?(0,r.jsx)(jn,{children:a(n,t)}):(0,r.jsx)(un.Od,{width:"80px",height:"12px",margin:"2px 0"}),s&&(0,r.jsx)(yn,{disabled:!n||n.isZero(),onClick:s,children:(0,r.jsx)(i.T3,{children:o("swap_max")})})]})};var kn,Cn,_n,zn,Zn,Tn;const On=d.zo.div(kn||(kn=(0,s.Z)(["\n    position: relative;\n    background: ",";\n    border-radius: ",";\n    padding: 6px 12px;\n"])),(e=>e.theme.backgroundContent),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall)),Pn=d.zo.div(Cn||(Cn=(0,s.Z)(["\n    color: ",";\n    gap: 8px;\n    display: flex;\n\n    padding: 4px 0;\n\n    > *:first-child {\n        margin-right: auto;\n    }\n\n    > * {\n        cursor: default;\n    }\n"])),(e=>e.theme.textSecondary)),En=d.zo.div(_n||(_n=(0,s.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 6px 0;\n"]))),Nn=d.zo.div(zn||(zn=(0,s.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 4px 0;\n    align-items: center;\n    height: 16px;\n\n    > * {\n        margin-left: auto;\n    }\n"]))),Fn=(0,d.zo)(sn)(Zn||(Zn=(0,s.Z)(["\n    flex-shrink: 0;\n"]))),Dn=(0,d.zo)((e=>{let{value:n,onChange:t,decimals:s,className:i,isErrored:o}=e;const[l,d]=(0,a.useState)("");(0,a.useEffect)((()=>{if(n){if(!l.endsWith((0,on.Yz)()))try{new h.Z((0,ln.rf)(l).replace((0,on.Yz)(),".")).eq(n)||d((0,ln.jM)(n))}catch(e){}}else d("")}),[n]);const c=(0,on.Yz)();return(0,r.jsx)(dn,{value:l,onChange:e=>(e=>{let n=(0,an.VI)(e);if(!n)return d(""),void t(void 0);if((0,an.vu)(n,s)&&(0,ln.kE)(n)){if(!n.endsWith((0,on.Yz)())){const e=new h.Z((0,ln.rf)(n).replace((0,on.Yz)(),".")),s=new h.Z((0,ln.rf)(l).replace((0,on.Yz)(),"."));e.eq(s)||(t(e),n=(0,ln.z6)(n))}d(n)}})(e.target.value),placeholder:"0".concat(c,"00"),className:i,isErrored:o,inputMode:"decimal"})}))(Tn||(Tn=(0,s.Z)(["\n    flex: 1;\n"]))),Rn=e=>{let{children:n}=e;const{t:t}=(0,H.$)(),[s,o]=(0,y.y)(),[a,l]=(0,y.g7)(),{data:d}=(0,y.Fu)();return(0,r.jsxs)(On,{children:[(0,r.jsxs)(Pn,{children:[(0,r.jsx)(i.De,{children:t("swap_send")}),(0,r.jsx)(bn,{})]}),(0,r.jsxs)(En,{children:[(0,r.jsx)(Fn,{token:a,onTokenChange:l}),(0,r.jsx)(Dn,{value:s,onChange:(0,be.Ds)(o),decimals:a.decimals,isErrored:!!d&&!!s&&s.gt((0,_.PE)(d,a.decimals))})]}),(0,r.jsx)(Nn,{children:(0,r.jsx)(hn,{amount:s,asset:a})}),n]})};var Mn,Bn,In,Kn,Un,Wn,Ln;const $n=d.zo.div(Mn||(Mn=(0,s.Z)(["\n    padding: 0 12px 12px;\n    background: ",";\n    border-radius: ",";\n    height: fit-content;\n"])),(e=>e.theme.backgroundContent),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall)),qn=d.zo.div(Bn||(Bn=(0,s.Z)(["\n    color: ",";\n    padding: 10px 0;\n    display: flex;\n    align-items: center;\n    > * {\n        cursor: default;\n    }\n"])),(e=>e.theme.textSecondary)),Jn=()=>{const{t:e}=(0,H.$)();return(0,y.RM)()?(0,r.jsx)("div",{}):(0,r.jsxs)($n,{children:[(0,r.jsx)(qn,{children:(0,r.jsx)(i.De,{children:e("swap_provider")})}),(0,r.jsx)(et,{provider:"stonfi"}),(0,r.jsx)(et,{provider:"dedust"})]})},Qn=d.zo.div(In||(In=(0,s.Z)(["\n    height: 56px;\n    border-radius: ",";\n    border: 1px solid ",";\n    padding: 0 12px;\n    display: flex;\n    gap: 0.5rem;\n    align-items: center;\n    cursor: ",";\n\n    transition: border-color 0.15s ease-in-out;\n\n    &:not(:last-child) {\n        margin-bottom: 8px;\n    }\n"])),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall),(e=>e.isActive?e.theme.accentBlue:e.theme.separatorCommon),(e=>e.isDisabled?"not-allowed":"pointer")),Gn=d.zo.img(Kn||(Kn=(0,s.Z)(["\n    width: 24px;\n    height: 24px;\n    border-radius: 6px;\n"]))),Hn=d.zo.div(Un||(Un=(0,s.Z)(["\n    padding: 10px 0;\n    display: flex;\n    flex-direction: column;\n"]))),Yn=d.zo.div(Wn||(Wn=(0,s.Z)(["\n    padding: 10px 0;\n    margin-left: auto;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n"]))),Vn=(0,d.zo)(i.De)(Ln||(Ln=(0,s.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),Xn={stonfi:{imageUrl:"https://wallet.tonkeeper.com/img/swap/stonfi.png",label:"STON.fi"},dedust:{imageUrl:"https://wallet.tonkeeper.com/img/swap/dedust.png",label:"DeDust"}},et=e=>{let{provider:n}=e;const{t:t}=(0,H.$)(),[s,o]=(0,y.K4)(),a=(null===s||void 0===s?void 0:s.provider)===n,{fetchedSwaps:l,isFetching:d}=K(),c=l.find((e=>e.provider===n)),p=null===c||void 0===c?void 0:c.trade,[u]=(0,y.dN)(),{data:m,isFetching:x}=(0,pn.UJ)((0,z.J)(u.address)),g=0===l.findIndex((e=>e.provider===n))&&!(null===c||void 0===c||!c.trade),v=Xn[n],{fiatAmount:f}=(0,pn.to)(m,(null===p||void 0===p?void 0:p.to.relativeAmount)||new h.Z(0));return(0,r.jsxs)(Qn,{isDisabled:!c||!p,isActive:a,onClick:()=>c&&p&&o(c),children:[(0,r.jsx)(Gn,{src:v.imageUrl}),(0,r.jsxs)(Hn,{children:[(0,r.jsx)(i.fA,{children:v.label}),g&&(0,r.jsx)(Vn,{children:t("swap_best_price")})]}),(0,r.jsx)(Yn,{children:d||p?(0,r.jsxs)(r.Fragment,{children:[p?(0,r.jsx)(i.fA,{children:p.to.stringAssetRelativeAmount}):(0,r.jsx)(un.Od,{width:"60px",height:"14px",margin:"3px 0"}),m&&p?(0,r.jsxs)(Vn,{children:["\u2248\xa0",f]}):x?(0,r.jsx)(un.Od,{width:"60px",height:"12px",margin:"2px 0"}):(0,r.jsx)("div",{})]}):(0,r.jsx)(Vn,{children:t("swap_trade_is_not_available")})})]})};var nt,tt,st,rt,it,ot,at,lt,dt,ct,pt,ut,mt,ht,xt,gt=t(98605);const vt=d.zo.div(nt||(nt=(0,s.Z)([""]))),ft=d.zo.div(tt||(tt=(0,s.Z)(["\n    cursor: pointer;\n    padding: 4px 0;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    color: ",";\n\n    svg {\n        color: ",";\n    }\n"])),(e=>e.theme.textSecondary),(e=>e.theme.textSecondary)),jt=d.zo.div(st||(st=(0,s.Z)(["\n    transform: translateY(-100%);\n    visibility: hidden;\n    transition: transform 0.2s ease-in-out, visibility 0.2s ease-in-out;\n"]))),wt=d.zo.div(rt||(rt=(0,s.Z)(["\n    display: grid;\n    grid-template-rows: ",";\n    overflow: ",";\n    transition: grid-template-rows 0.2s ease-in-out;\n\n    "," {\n        ","\n    }\n"])),(e=>e.isOpened?"1fr":"0fr"),(e=>e.animationCompleted&&e.isOpened?"visible":"hidden"),jt,(e=>e.isOpened&&(0,d.iv)(it||(it=(0,s.Z)(["\n                transform: translateY(0);\n                visibility: visible;\n            "]))))),yt=d.zo.div(ot||(ot=(0,s.Z)(["\n    min-height: 0;\n"]))),bt=(0,d.zo)(k.h)(at||(at=(0,s.Z)(["\n    transform: ",";\n    transition: transform 0.2s ease-in-out;\n    border: none;\n"])),(e=>e.isOpened?"rotate(180deg)":"rotate(0deg)")),At=d.zo.div(lt||(lt=(0,s.Z)(["\n    position: relative;\n    display: flex;\n    padding: 4px 0;\n    gap: 6px;\n    align-items: center;\n\n    > * {\n        cursor: default;\n    }\n"]))),St=d.zo.div(dt||(dt=(0,s.Z)(["\n    pointer-events: none;\n    transform: translate3d(0, -10px, 0);\n    z-index: 100;\n    left: 0;\n    right: 0;\n    transition: all 0.15s ease-in-out;\n    opacity: 0;\n    position: absolute;\n    background-color: ",";\n    padding: 8px 12px;\n    ",";\n    ",";\n\n    ","\n"])),(e=>e.theme.backgroundContentTint),gt.G,i.C2,(e=>"top"===e.placement?(0,d.iv)(ct||(ct=(0,s.Z)(["\n                  transform: translate3d(0, 10px, 0);\n                  bottom: 30px;\n              "]))):(0,d.iv)(pt||(pt=(0,s.Z)(["\n                  transform: translate3d(0, -10px, 0);\n                  top: 30px;\n              "]))))),kt=d.zo.div(ut||(ut=(0,s.Z)(["\n    cursor: pointer;\n\n    &:hover + "," {\n        opacity: 1;\n        transform: translate3d(0, 0, 0);\n    }\n"])),St),Ct=(0,d.zo)(i.De)(mt||(mt=(0,s.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),_t=(0,d.zo)(i.De)(ht||(ht=(0,s.Z)(["\n    margin-left: auto;\n"]))),zt=()=>(0,r.jsx)(un.Od,{width:"60px",height:"12px",margin:"2px 0"}),Zt=(0,d.zo)(i.De)(xt||(xt=(0,s.Z)(["\n    color: ",";\n"])),(e=>"low"===e.status?e.theme.accentGreen:"medium"===e.status||"unknown"===e.status?e.theme.accentOrange:e.theme.accentRed)),Tt=()=>{const{t:e}=(0,H.$)(),[n,t]=(0,a.useState)(!1),[s,o]=(0,a.useState)(!1),l=(0,a.useRef)(),{isFetching:d}=K(),[c]=(0,y.K4)(),p=(0,y.MT)(),{data:u}=j(),m=(0,y.RM)(),h=null===c||void 0===c?void 0:c.trade;if(!d&&!h||m)return null;return(0,r.jsxs)(vt,{children:[(0,r.jsxs)(ft,{onClick:()=>{clearTimeout(l.current),n?(o(!1),t(!1)):(t(!0),l.current=setTimeout((()=>o(!0)),400))},children:[(0,r.jsx)(i.De,{children:e("swap_tx_info")}),(0,r.jsx)(bt,{transparent:!0,isOpened:n,children:(0,r.jsx)(A.v4,{})})]}),(0,r.jsx)(wt,{isOpened:n,animationCompleted:s,children:(0,r.jsx)(yt,{children:(0,r.jsxs)(jt,{children:[(0,r.jsxs)(At,{children:[(0,r.jsx)(Ct,{children:e("swap_price_impact")}),(0,r.jsx)(kt,{children:(0,r.jsx)(A.uM,{})}),(0,r.jsx)(St,{placement:"top",children:e("swap_price_impact_tooltip")}),(0,r.jsx)(_t,{children:void 0!==p&&h?(0,r.jsx)(Zt,{status:(0,y.DC)(p),children:p?(0,r.jsxs)(r.Fragment,{children:["\u2248\xa0","".concat(p.multipliedBy(100).decimalPlaces(2).toString().replace(".",(0,on.Yz)()).replace("-","+"),"%")]}):e("swap_unknown_price_impact")}):(0,r.jsx)(zt,{})})]}),(0,r.jsxs)(At,{children:[(0,r.jsx)(Ct,{children:e("swap_minimum_received")}),(0,r.jsx)(kt,{children:(0,r.jsx)(A.uM,{})}),(0,r.jsx)(St,{placement:"top",children:e("swap_minimum_received_tooltip")}),(0,r.jsx)(_t,{children:h&&u?(0,r.jsxs)(i.De,{children:["\u2248\xa0",new Z.n({weiAmount:h.to.weiAmount.multipliedBy(100-u.slippagePercent).div(100),asset:h.to.asset}).stringAssetRelativeAmount]}):(0,r.jsx)(zt,{})})]}),(0,r.jsxs)(At,{children:[(0,r.jsx)(Ct,{children:e("swap_slippage")}),(0,r.jsx)(kt,{children:(0,r.jsx)(A.uM,{})}),(0,r.jsx)(St,{placement:"top",children:e("swap_slippage_tooltip")}),(0,r.jsx)(_t,{children:h&&u?(0,r.jsxs)(i.De,{children:[u.slippagePercent,"%"]}):(0,r.jsx)(zt,{})})]}),(0,r.jsxs)(At,{children:[(0,r.jsx)(Ct,{children:e("swap_blockchain_fee")}),(0,r.jsx)(kt,{children:(0,r.jsx)(A.uM,{})}),(0,r.jsx)(St,{placement:"top",children:e("swap_blockchain_fee_tooltip")}),(0,r.jsx)(_t,{children:h?(0,r.jsxs)(i.De,{children:["\u2248\xa0",h.blockchainFee.stringAssetRelativeAmount]}):(0,r.jsx)(zt,{})})]}),(0,r.jsxs)(At,{children:[(0,r.jsx)(Ct,{children:e("swap_route")}),(0,r.jsx)(_t,{children:h?(0,r.jsx)(i.De,{children:h.path.map((e=>e.symbol)).join(" \u2192 ")}):(0,r.jsx)(zt,{})})]})]})})})]})};var Ot,Pt;const Et=(0,d.zo)(i.De)(Ot||(Ot=(0,s.Z)(["\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    color: ",";\n    cursor: pointer;\n    transition: color 0.15s ease-in-out;\n\n    &:hover {\n        ",";\n    }\n"])),(e=>"medium"===e.impact?e.theme.accentOrange:"high"===e.impact?e.theme.accentRed:e.theme.textSecondary),(e=>"medium"!==e.impact&&"high"!==e.impact&&(0,d.iv)(Pt||(Pt=(0,s.Z)(["\n                color: ",";\n            "])),e.theme.textPrimary))),Nt=()=>(0,r.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.18144 1.65C4.63413 0.86592 4.86047 0.473881 5.11842 0.286474C5.64415 -0.0954914 6.35604 -0.0954914 6.88177 0.286474C7.13971 0.473881 7.36606 0.86592 7.81875 1.65L11.1096 7.35L11.1097 7.35001C11.5623 8.13408 11.7887 8.52612 11.822 8.84321C11.8899 9.48949 11.534 10.106 10.9403 10.3703C10.6491 10.5 10.1964 10.5 9.29099 10.5H2.7092C1.80382 10.5 1.35113 10.5 1.05986 10.3703C0.466204 10.106 0.110258 9.48949 0.178184 8.84321C0.211512 8.52612 0.437856 8.13408 0.890544 7.35L4.18144 1.65ZM5.1001 8.1C5.1001 7.60294 5.50304 7.2 6.0001 7.2C6.49715 7.2 6.9001 7.60294 6.9001 8.1C6.9001 8.59706 6.49715 9 6.0001 9C5.50304 9 5.1001 8.59706 5.1001 8.1ZM6.00002 2C5.53718 2 5.16822 2.38674 5.18997 2.84906L5.31946 5.60072C5.33656 5.96414 5.63619 6.25 6.00002 6.25C6.36384 6.25 6.66347 5.96414 6.68057 5.60072L6.81006 2.84906C6.83182 2.38674 6.46285 2 6.00002 2Z",fill:"currentColor"})}),Ft=()=>{const[e,n]=(0,a.useState)("from"),[t]=(0,y.K4)(),{isFetching:s}=K(),i=(0,y.MT)(),o=s&&!(null!==t&&void 0!==t&&t.trade)||void 0===i;if(!s&&!(null!==t&&void 0!==t&&t.trade))return null;if(o)return(0,r.jsx)(un.Od,{width:"100px",height:"12px",margin:"2px 0"});const l=t.trade,d="from"===e?l.from:l.to,c="from"===e?l.to:l.from;if(d.relativeAmount.isZero())return null;const p=c.relativeAmount.div(d.relativeAmount),u=Z.n.fromRelativeAmount({amount:p,asset:c.asset}),m=(0,y.DC)(i);return(0,r.jsxs)(Et,{impact:m,onClick:()=>n((e=>"from"===e?"to":"from")),children:["1\xa0",d.asset.symbol,"\xa0\u2248\xa0",u.stringAssetRelativeAmount,("medium"===m||"high"===m)&&(0,r.jsx)(Nt,{})]})};var Dt,Rt,Mt,Bt,It,Kt,Ut;const Wt=d.zo.div(Dt||(Dt=(0,s.Z)(["\n    background: ",";\n    border-radius: ",";\n    padding: 6px 12px;\n"])),(e=>e.theme.backgroundContent),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall)),Lt=d.zo.div(Rt||(Rt=(0,s.Z)(["\n    color: ",";\n    gap: 8px;\n    display: flex;\n\n    padding: 4px 0;\n\n    > *:first-child {\n        margin-right: auto;\n    }\n\n    > * {\n        cursor: default;\n    }\n"])),(e=>e.theme.textSecondary)),$t=d.zo.div(Mt||(Mt=(0,s.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 6px 0;\n"]))),qt=d.zo.div(Bt||(Bt=(0,s.Z)(["\n    margin-left: auto;\n    overflow: auto;\n\n    cursor: default;\n\n    &::-webkit-scrollbar {\n        display: none;\n    }\n\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n"]))),Jt=d.zo.div(It||(It=(0,s.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 4px 0;\n    align-items: center;\n    height: 16px;\n\n    > :last-child {\n        margin-left: auto;\n    }\n"]))),Qt=(0,d.zo)(sn)(Kt||(Kt=(0,s.Z)(["\n    flex-shrink: 0;\n"]))),Gt=(0,d.zo)(i.J1)(Ut||(Ut=(0,s.Z)(["\n    color: ",";\n"])),(e=>e.theme.textTertiary)),Ht=()=>{var e;const{t:n}=(0,H.$)(),[t,s]=(0,y.dN)(),{isFetching:o}=K(),[a]=(0,y.K4)();return(0,r.jsxs)(Wt,{children:[(0,r.jsxs)(Lt,{children:[(0,r.jsx)(i.De,{children:n("swap_receive")}),(0,r.jsx)(An,{})]}),(0,r.jsxs)($t,{children:[(0,r.jsx)(Qt,{token:t,onTokenChange:s}),(0,r.jsx)(qt,{children:null!==a&&void 0!==a&&a.trade||!o?null!==a&&void 0!==a&&a.trade?(0,r.jsx)(i.J1,{children:a.trade.to.stringRelativeAmount}):(0,r.jsx)(Gt,{children:"0"}):(0,r.jsx)(un.Od,{width:"100px",height:"28px",margin:"4px 0"})})]}),(0,r.jsxs)(Jt,{children:[(0,r.jsx)(Ft,{}),(0,r.jsx)(hn,{amount:null===a||void 0===a||null===(e=a.trade)||void 0===e?void 0:e.to.relativeAmount,asset:t})]}),(0,r.jsx)(Tt,{})]})};var Yt,Vt;const Xt=d.zo.div(Yt||(Yt=(0,s.Z)(["\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n"]))),es=(0,d.zo)(k.h)(Vt||(Vt=(0,s.Z)(["\n    height: 32px;\n    width: 32px;\n    position: absolute;\n    right: calc(50% - 16px);\n    bottom: -20px;\n    border: none;\n\n    background-color: ",";\n\n    > svg {\n        transition: color 0.15s ease-in-out;\n    }\n\n    &:hover {\n        background-color: ",";\n        > svg {\n            color: ",";\n        }\n    }\n"])),(e=>e.theme.buttonTertiaryBackground),(e=>e.theme.buttonTertiaryBackgroundHighlighted),(e=>e.theme.iconPrimary)),ns=e=>{let{className:n}=e;const t=(0,d.Fg)(),{isLoading:s,mutateAsync:i}=function(){const{active:e}=(0,u.tN)(),{swapService:n}=(0,m.W)(),{config:t}=(0,u.bp)(),{data:s}=j(),r=t.web_swaps_referral_address;return(0,p.useMutation)((t=>{if(!s)throw new Error("SwapOptions query was not resolved yet");return n.encodeSwap({swap:w(t),options:{senderAddress:e.rawAddress,slippage:new h.Z(s.slippagePercent).div(100).decimalPlaces(5).toString(),...r&&{referralAddress:o.Address.parse(r).toRawString()}}})}))}(),[x,g]=(0,a.useState)(null),[v]=(0,y.K4)(),[f,k]=(0,y.g7)(),[C,_]=(0,y.dN)(),[z,Z]=(0,y.y)(),T=(0,l.s0)(),[O,P]=(0,b.J)();return(0,r.jsxs)(Xt,{className:n,children:[(0,r.jsx)(Rn,{children:(0,r.jsx)(es,{onClick:()=>{k(C),_(f),null!==v&&void 0!==v&&v.trade&&Z(v.trade.to.relativeAmount)},children:(0,r.jsx)(A.Td,{})})}),(0,r.jsx)(Ht,{}),"compact"===t.displayType&&(0,r.jsx)(Jn,{}),(0,r.jsx)(Y,{onClick:async()=>{const e=await i(v);g({valid_until:(Date.now()+6e5)/1e3,messages:[{address:o.Address.parse(e.to).toString({bounceable:!0}),amount:e.value,payload:e.body}]})},isEncodingProcess:s||!!x}),(0,r.jsx)(S.o,{handleClose:e=>{g(null),e&&(T(c.FR.activity),P(!1))},params:x,waitInvalidation:!0}),(0,r.jsx)($e,{})]})},ts=(0,a.createContext)(null),ss={didCatch:!1,error:null};class rs extends a.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=ss}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var n,t,s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];null===(n=(t=this.props).onReset)||void 0===n||n.call(t,{args:r,reason:"imperative-api"}),this.setState(ss)}}componentDidCatch(e,n){var t,s;null===(t=(s=this.props).onError)||void 0===t||t.call(s,e,n)}componentDidUpdate(e,n){const{didCatch:t}=this.state,{resetKeys:s}=this.props;var r,i;t&&null!==n.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==n.length||e.some(((e,t)=>!Object.is(e,n[t])))}(e.resetKeys,s)&&(null===(r=(i=this.props).onReset)||void 0===r||r.call(i,{next:s,prev:e.resetKeys,reason:"keys"}),this.setState(ss))}render(){const{children:e,fallbackRender:n,FallbackComponent:t,fallback:s}=this.props,{didCatch:r,error:i}=this.state;let o=e;if(r){const e={error:i,resetErrorBoundary:this.resetErrorBoundary};if("function"===typeof n)o=n(e);else if(t)o=(0,a.createElement)(t,e);else{if(null!==s&&!(0,a.isValidElement)(s))throw i;o=s}}return(0,a.createElement)(ts.Provider,{value:{didCatch:r,error:i,resetErrorBoundary:this.resetErrorBoundary}},o)}}var is,os;const as=d.zo.label(is||(is=(0,s.Z)(["\n    cursor: pointer;\n    ",";\n    ",";\n    box-sizing: border-box;\n\n    text-align: center;\n\n    padding: 8px 12px;\n\n    background: ",";\n    border: 1px solid transparent;\n    transition: border-color 0.15s ease-in-out;\n"])),gt.G,i.C2,(e=>e.theme.fieldBackground)),ls=d.zo.input(os||(os=(0,s.Z)(["\n    display: none;\n\n    &:checked + "," {\n        border: 1px solid ",";\n    }\n"])),as,(e=>e.theme.accentBlue)),ds=(0,a.forwardRef)(((e,n)=>{const t=(0,a.useId)(),s=e.id||t,{className:i,children:o,...l}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ls,{type:"radio",ref:n,id:s,...l}),(0,r.jsx)(as,{className:i,htmlFor:s,children:o})]})}));var cs,ps,us,ms,hs;const xs=e=>{let{isOpen:n,onClose:t}=e;const{t:s}=(0,H.$)();return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(V.P_,{isOpen:n,handleClose:t,title:s("swap_settings"),children:()=>(0,r.jsx)(As,{onClose:t})})})},gs=d.zo.div(cs||(cs=(0,s.Z)(["\n    padding-bottom: 10px;\n\n    > * {\n        display: block;\n        cursor: default;\n    }\n\n    > "," {\n        color: ",";\n    }\n"])),i.De,(e=>e.theme.textSecondary)),vs=d.zo.div(ps||(ps=(0,s.Z)(["\n    display: flex;\n    gap: 0.5rem;\n    margin-bottom: 2rem;\n"]))),fs=(0,d.zo)(ds)(us||(us=(0,s.Z)(["\n    height: 36px;\n    flex: 1;\n"]))),js=d.zo.div(ms||(ms=(0,s.Z)(["\n    display: flex;\n    gap: 0.5rem;\n    > * {\n        flex: 1;\n    }\n"]))),ws=[.5,1,3,5],ys=ws[1],bs=d.zo.div(hs||(hs=(0,s.Z)(["\n    height: 200px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n"]))),As=e=>{let{onClose:n}=e;const{t:t}=(0,H.$)(),{data:s}=j(),{mutate:o}=(()=>{const e=(0,x._H)(),n=(0,p.useQueryClient)();return(0,p.useMutation)((async t=>{const s=await e.storage.get(g.l.SWAP_OPTIONS);await e.storage.set(g.l.SWAP_OPTIONS,{...s,...t}),await n.invalidateQueries([g.l.SWAP_OPTIONS])}))})(),[l,d]=(0,a.useState)();if((0,a.useLayoutEffect)((()=>{null!==s&&void 0!==s&&s.slippagePercent&&(ws.includes(null===s||void 0===s?void 0:s.slippagePercent)?d(null===s||void 0===s?void 0:s.slippagePercent):(d(ys),o({slippagePercent:ys})))}),[null===s||void 0===s?void 0:s.slippagePercent]),!s)return(0,r.jsx)(bs,{children:(0,r.jsx)(A.L4,{})});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(gs,{children:[(0,r.jsx)(i.fA,{children:t("swap_slippage")}),(0,r.jsx)(i.De,{children:t("swap_slippage_description")})]}),(0,r.jsx)(vs,{children:ws.map((e=>(0,r.jsxs)(fs,{name:"slippage-percent",value:e,checked:l===e,onChange:()=>d(e),children:[e,"%"]},e)))}),(0,r.jsxs)(js,{children:[(0,r.jsx)(C.zx,{secondary:!0,onClick:n,children:t("cancel")}),(0,r.jsx)(C.zx,{primary:!0,disabled:l===s.slippagePercent,onClick:()=>{o({slippagePercent:l}),null===n||void 0===n||n()},children:t("save")})]})]})},Ss=()=>{const[e,n]=(0,a.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.S,{onClick:()=>n(!0),children:(0,r.jsx)(A.bZ,{})}),(0,r.jsx)(xs,{isOpen:e,onClose:()=>n(!1)})]})};let ks=!1;const Cs=()=>{const{refetch:e,isFetching:n}=K(),[t,s]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{if(ks=!1,!n){s(!0);const n=setTimeout((()=>{ks||(e(),ks=!0)}),15e3);return()=>clearTimeout(n)}s(!1)}),[n]),(0,r.jsx)(k.S,{onClick:()=>e(),children:t?(0,r.jsx)(A.ut,{}):(0,r.jsx)(A.Du,{})})};var _s,zs,Zs,Ts;const Os=d.zo.div(_s||(_s=(0,s.Z)(["\n    position: relative;\n"]))),Ps=d.zo.div(zs||(zs=(0,s.Z)(["\n    display: flex;\n"]))),Es=(0,d.zo)(i.fA)(Zs||(Zs=(0,s.Z)(["\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 5rem;\n    right: 2rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: transparent;\n"]))),Ns=()=>{const{t:e}=(0,H.$)();return(0,r.jsxs)(Os,{children:[(0,r.jsxs)(Ps,{children:[(0,r.jsx)(Cs,{}),(0,r.jsx)(Ss,{})]}),(0,r.jsx)(Es,{children:e("wallet_swap")})]})},Fs=d.zo.div(Ts||(Ts=(0,s.Z)(["\n    overflow-y: auto;\n    min-height: calc(var(--app-height) - 7rem);\n"]))),Ds=()=>(0,r.jsx)(Fs,{children:(0,r.jsx)(ns,{})}),Rs=()=>{const[e,n]=(0,b.J)();return(0,r.jsx)(rs,{fallbackRender:(t="Failed to display Swap page",e=>{let{error:n}=e;return(0,r.jsxs)("div",{role:"alert",children:[(0,r.jsx)("p",{children:t}),(0,r.jsx)("p",{children:"Something went wrong:"}),(0,r.jsx)("pre",{style:{color:"red"},children:n.message})]})}),children:(0,r.jsx)(V.P_,{isOpen:e,handleClose:()=>n(!1),title:(0,r.jsx)(Ns,{}),children:()=>(0,r.jsx)(Ds,{})})});var t}},20504:(e,n,t)=>{t.d(n,{Iy:()=>A,L:()=>k,UE:()=>_,bB:()=>Z,r7:()=>C});var s=t(41235),r=t(11707),i=t(86445),o=t(14182),a=t(76978),l=t(39079),d=t(48544),c=t(97284),p=t(93853),u=t(20220),m=t(34692),h=t(72791),x=t(87594),g=t(23098),v=t(72119),f=t(97957),j=t(60793),w=t(7393),y=t(57443),b=t(94216);function A(){const{swapService:e}=(0,b.W)(),{data:n}=z();return(0,s.useQuery)({queryKey:[f.S8.swapAllAssets,n],queryFn:async()=>{try{const t=await e.swapAssets();return t.map((e=>{const n="ton"===e.address?"TON":r.Address.parse(e.address);return{id:(0,l.G)(o.S.TON,n),symbol:e.symbol,decimals:e.decimals,name:e.name,image:e.image,blockchain:o.S.TON,address:n}})).filter((e=>!(n||[]).some((n=>n.id===e.id)))).concat(n||[])}catch(t){return console.error(t),[]}},enabled:!!n})}const S=(0,v.cn)("");function k(){return(0,v.KO)(S)}const C=()=>{const[e]=k(),{data:n}=function(){const[e]=(0,j.L)(),{data:n}=A(),{data:t}=(0,y.UJ)(o.C.TON),{fiat:i}=(0,x.bp)();return(0,s.useQuery)({queryKey:[f.S8.swapWalletAssets,n,e,t,i],queryFn:async()=>{if(!e||!n||!t)return[];const s=n.map((n=>{var s;if((0,d.kC)(n.address))return{assetAmount:new a.n({asset:n,weiAmount:e.ton.info.balance}),fiatAmount:(0,p.PE)(new m.Z(e.ton.info.balance)).multipliedBy(t.prices)};const o=e.ton.jettons.balances.find((e=>r.Address.parse(e.jetton.address).equals(n.address)));return{assetAmount:new a.n({asset:n,weiAmount:(null===o||void 0===o?void 0:o.balance)||0}),fiatAmount:(0,p.PE)(new m.Z((null===o||void 0===o?void 0:o.balance)||0),n.decimals).multipliedBy(new m.Z((null===o||void 0===o||null===(s=o.price)||void 0===s||null===(s=s.prices)||void 0===s?void 0:s[i])||0))}}));return s.sort(((e,n)=>e.fiatAmount.isZero()&&n.fiatAmount.isZero()?n.assetAmount.weiAmount.comparedTo(e.assetAmount.weiAmount):n.fiatAmount.comparedTo(e.fiatAmount))),s},enabled:!!e&&!!n&&!!t})}();return(0,h.useMemo)((()=>{if(n)return n.filter((n=>{var t;if(!e)return!0;if((0,u.Ig)(e))return r.Address.parse(e).equals(n.assetAmount.asset.address);const s=e.toUpperCase();return!!(n.assetAmount.asset.symbol.toUpperCase().includes(s)||null!==(t=n.assetAmount.asset.name)&&void 0!==t&&t.toUpperCase().includes(s))||void 0}))}),[e,n])},_=()=>{const[e]=k(),n=(0,u.Ig)(e),{api:t,fiat:i}=(0,x.bp)(),{data:d}=(0,w.NR)();return(0,s.useQuery)({queryKey:[f.S8.swapCustomToken,e,d,i],queryFn:async()=>{if(!n)return null;try{var s;const n=r.Address.parse(e),u=await new c.EkG(t.tonApiV2).getJettonInfo({accountId:n.toRawString()}),h={address:n,image:u.metadata.image,blockchain:o.S.TON,name:u.metadata.name,symbol:u.metadata.symbol,decimals:Number(u.metadata.decimals),id:(0,l.G)(o.S.TON,n)},x=null===d||void 0===d?void 0:d.balances.find((e=>r.Address.parse(e.jetton.address).equals(n)));return{assetAmount:new a.n({asset:h,weiAmount:(null===x||void 0===x?void 0:x.balance)||new m.Z(0)}),fiatAmount:(0,p.PE)(new m.Z((null===x||void 0===x?void 0:x.balance)||0),h.decimals).multipliedBy(new m.Z((null===x||void 0===x||null===(s=x.price)||void 0===s||null===(s=s.prices)||void 0===s?void 0:s[i])||0))}}catch(u){return console.error(u),null}},enabled:n&&!!d})},z=()=>{const e=(0,g._H)();return(0,s.useQuery)([i.l.SWAP_CUSTOM_ASSETS],(async()=>{const n=await e.storage.get(i.l.SWAP_CUSTOM_ASSETS);return(null===n||void 0===n?void 0:n.map((e=>({...e,blockchain:e.blockchain,address:(0,d.Wx)(e.address),id:(0,l.G)(e.blockchain,e.address)}))))||[]}))},Z=()=>{const e=(0,g._H)(),n=(0,s.useQueryClient)();return(0,s.useMutation)((async t=>{const s=await e.storage.get(i.l.SWAP_CUSTOM_ASSETS)||[];await e.storage.set(i.l.SWAP_CUSTOM_ASSETS,[...s,{...t,address:(0,d.J)(t.address)}]),await n.invalidateQueries([i.l.SWAP_CUSTOM_ASSETS])}))}}}]);
//# sourceMappingURL=683.1da16534.chunk.js.map