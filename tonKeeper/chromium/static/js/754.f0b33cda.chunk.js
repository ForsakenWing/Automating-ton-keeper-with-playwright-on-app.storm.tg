"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[754],{37460:(e,n,t)=>{t.d(n,{Ao:()=>h,DG:()=>x,Dx:()=>p,Ee:()=>m,kI:()=>u});var s,r,i,o,a,d=t(30168),c=t(65867),l=t(47712);const u=c.ZP.div(s||(s=(0,d.Z)(["\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    margin-bottom: 1rem;\n"]))),m=c.ZP.img(r||(r=(0,d.Z)(["\n    width: 96px;\n    height: 96px;\n    border-radius: ",";\n"])),(e=>e.full?e.theme.cornerFull:e.theme.cornerMedium)),h=c.ZP.div(i||(i=(0,d.Z)(["\n    width: 96px;\n    height: 96px;\n    border-radius: ",";\n    background: ",";\n"])),(e=>e.full?e.theme.cornerFull:e.theme.cornerMedium),(e=>e.theme.backgroundContent)),x=(0,c.ZP)(l.mI)(o||(o=(0,d.Z)(["\n    user-select: none;\n    color: ",";\n    margin: 20px 0 4px;\n"])),(e=>e.theme.textSecondary)),p=(0,c.ZP)(l.H3)(a||(a=(0,d.Z)(["\n    user-select: none;\n    text-align: center;\n"])))},38705:(e,n,t)=>{t.d(n,{CP:()=>V,NG:()=>H,RB:()=>Q,eZ:()=>O,f1:()=>W,mC:()=>U,n_:()=>L,pk:()=>I,tv:()=>M,uq:()=>z,vD:()=>F,vp:()=>D});var s,r,i,o,a=t(30168),d=t(80184),c=t(41235),l=t(1849),u=t(87731),m=t(72791),h=t(65867),x=t(87594),p=t(23098),g=t(61819),v=t(61945),j=t(87812),f=t(5784),_=t(73643),S=t(26503),b=t(47578),w=t(47712),y=t(89050),C=t(59598),k=t(68827),N=t(37460),Z=t(64068),A=t(98502),T=t(35281),P=t(48063);const F=(0,m.createContext)({});function R(){return(0,m.useContext)(F)}function D(e){let{children:n,estimation:t,recipient:s,onBack:r,onClose:i,assetAmount:o,fitContent:a,...l}=e;const{mutateAsync:u,isLoading:h,reset:p}=l,g=(0,c.useQueryClient)(),v=l.error||t.error;let j=(0,d.jsx)(M,{children:(0,d.jsx)(H,{})}),f=(0,d.jsx)(O,{children:(0,d.jsx)(B,{})}),w=(0,d.jsxs)(V,{children:[(0,d.jsx)(L,{}),(0,d.jsx)(I,{}),(0,d.jsx)(Q,{}),(0,d.jsx)(W,{})]}),y=(0,d.jsx)(U,{children:(0,d.jsx)(z,{MainButton:A.y8})});m.Children.map(n,(e=>{if((0,m.isValidElement)(e))switch(e.type){case M:return void(j=e);case O:return void(f=e);case V:return void(w=e);case U:return void(y=e)}}));const[C,k]=(0,m.useState)(!1),{standalone:N}=(0,x.bp)(),Z=async()=>{if(h)return!1;p();try{const e=await u();return e&&(k(!0),setTimeout((()=>{setTimeout((()=>g.invalidateQueries()),100),i(!0)}),2e3)),e}catch(e){return console.error(e),!1}};return(0,d.jsx)(F.Provider,{value:{recipient:s,assetAmount:o,estimation:t,formState:{done:C,isLoading:h,error:v},onClose:()=>i(),onBack:r,handleSubmit:Z},children:(0,d.jsxs)(b.Jz,{onSubmit:async e=>{e.stopPropagation(),e.preventDefault(),Z()},standalone:N,fitContent:a,children:[j,f,(0,d.jsx)(S.L8,{margin:!1,fullWidth:!0,children:w}),(0,d.jsx)(_.Zv,{}),(0,d.jsx)(A.aT,{children:y})]})})}const E=h.ZP.div(s||(s=(0,a.Z)(["\n    margin-bottom: 1rem;\n"]))),M=e=>{let{children:n}=e;return(0,d.jsx)(d.Fragment,{children:n})},H=()=>{const{onClose:e,onBack:n}=R();return(0,d.jsxs)(b.hy,{children:[n?(0,d.jsx)(k.z,{onClick:n,children:(0,d.jsx)(f.wy,{})}):(0,d.jsx)("div",{}),(0,d.jsx)(b.Ho,{handleClose:()=>e()})]})},O=e=>{let{children:n,className:t}=e;return(0,d.jsx)(E,{className:t,children:n})},B=e=>{let{className:n,title:t}=e;const{t:s}=(0,v.$)(),{recipient:r,assetAmount:i}=R(),o=(0,j.vP)(i.asset),a={[l.Ct.id]:s("txActions_signRaw_types_tonTransfer"),[l.tr.id]:s("txActions_USDT_transfer")};t||(t=(0,u.FR)(r)?r.toAccount.name:a[i.asset.id]||s("txActions_signRaw_types_jettonTransfer"));const c=(0,u.FR)(r)&&r.toAccount.icon||o;return(0,d.jsxs)(N.kI,{className:n,children:[c?(0,d.jsx)(N.Ee,{full:!0,src:o}):(0,d.jsx)(N.Ao,{full:!0}),(0,d.jsx)(N.DG,{children:s("confirm_sending_title")}),(0,d.jsx)(N.Dx,{children:t})]})},V=e=>{let{children:n}=e;return(0,d.jsx)(d.Fragment,{children:n})},L=()=>{const{recipient:e}=R();return(0,d.jsx)(Z.AI,{recipient:e})},I=()=>{const{fiat:e}=(0,x.bp)(),{assetAmount:n}=R(),{data:t}=(0,j.Vg)(n),s=t?(0,g.hE)(e,t):void 0;return(0,d.jsx)(Z.Yg,{coinAmount:n.stringAssetRelativeAmount,fiatAmount:s})},Q=()=>{var e;const{estimation:n}=R();return(0,d.jsx)(C.Kk,{fee:n.isFetching||null===(e=n.data)||void 0===e?void 0:e.fee})},W=()=>{const{recipient:e}=R();return(0,u.FR)(e)?(0,d.jsx)(y.Az,{comment:e.comment}):null},$=(0,h.ZP)(f.Jq)(r||(r=(0,a.Z)(["\n    min-width: 32px;\n    min-height: 32px;\n"]))),q=(0,h.ZP)(w.fA)(i||(i=(0,a.Z)(["\n    text-align: center;\n"]))),K=(0,h.ZP)(A.MK)(o||(o=(0,a.Z)(["\n    height: unset;\n    min-height: 56px;\n"]))),U=e=>{let{children:n}=e;return(0,d.jsx)(d.Fragment,{children:n})},z=e=>{let{MainButton:n}=e;const t=(0,p._H)(),{formState:{done:s,error:r,isLoading:i},estimation:{isFetching:o},onClose:a,handleSubmit:c}=R(),{t:l}=(0,v.$)(),u=!i&&!o;return(0,m.useEffect)((()=>{s&&t.hapticNotification("success")}),[s]),(0,m.useEffect)((()=>{r&&t.hapticNotification("error")}),[r]),s?(0,d.jsxs)(A.MK,{done:!0,children:[(0,d.jsx)(f.nS,{}),(0,d.jsx)(w.fA,{children:l("send_screen_steps_done_done_label")})]}):!r||r instanceof T.T?(0,d.jsx)(n,{isDisabled:!u,isLoading:i,onClick:c,onClose:a}):(0,d.jsxs)(K,{children:[(0,d.jsx)($,{}),(0,d.jsx)(q,{children:r instanceof P.E?r.message:l("send_publish_tx_error")})]})}},86749:(e,n,t)=>{t.d(n,{Aq:()=>se,gW:()=>Y});var s,r,i=t(30168),o=t(80184),a=t(41235),d=t(14182),c=t(97284),l=t(20220),u=t(72791),m=t(65867),h=t(87594),x=t(23098),p=t(42770),g=t(61945),v=t(82430),j=t(39120),f=t(97957),_=t(29681),S=t(73643),b=t(47578),w=t(47712),y=t(90820),C=t(5784),k=t(96423);const N=m.ZP.div(s||(s=(0,i.Z)(["\n    position: absolute;\n    right: 1rem;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n    color: ",";\n\n    &:hover {\n        color: ",";\n    }\n"])),(e=>e.theme.textSecondary),(e=>e.theme.textTertiary)),Z=m.ZP.div(r||(r=(0,i.Z)(["\n    position: absolute;\n    right: 1rem;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n\n    color: ",";\n"])),(e=>e.theme.accentBlue)),A=u.forwardRef(((e,n)=>{let{value:t,onChange:s,isValid:r=!0,label:i,disabled:a,onScan:d,onSubmit:c}=e;const[l,m]=(0,u.useState)(!1),[p,g]=(0,u.useState)(void 0),v=(0,x._H)(),{hideQrScanner:j}=(0,h.bp)();return(0,u.useEffect)((()=>{const e=e=>{e.id===p&&d(e.params)};return v.uiEvents.on("response",e),()=>{v.uiEvents.off("response",e)}}),[v,p,d]),(0,o.jsxs)(y.S7,{focus:l,valid:r,scanner:!0,children:[(0,o.jsx)(k.u,{onSubmit:c,ref:n,disabled:a,value:t,onChange:e=>s&&s(e.target.value),onFocus:()=>m(!0),onBlur:()=>m(!1)}),i&&(0,o.jsx)(y.__,{active:""!==t,children:i}),""===t?!0===j?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(Z,{onClick:e=>{if(e.stopPropagation(),e.preventDefault(),a)return;const n=Date.now();v.uiEvents.emit("scan",{method:"scan",id:n,params:void 0}),g(n)},children:(0,o.jsx)(C.bJ,{})}):(0,o.jsx)(N,{onClick:e=>{e.stopPropagation(),e.preventDefault(),a||null===s||void 0===s||s("")},children:(0,o.jsx)(C.wq,{})})]})}));var T,P,F=t(81987);const R=m.ZP.div(T||(T=(0,i.Z)(["\n    position: relative;\n    width: 100%;\n"]))),D=(0,m.ZP)(w.mI)(P||(P=(0,i.Z)(["\n    position: absolute;\n    bottom: 0;\n    line-height: 46px;\n    left: ","px;\n    color: ",";\n    user-select: none;\n"])),(e=>Math.ceil(e.inputTextWidth)+46),(e=>e.theme.textSecondary)),E=e=>{let{value:n,children:t}=e;return(0,o.jsxs)(R,{children:[t,n&&(0,o.jsx)(D,{inputTextWidth:n.inputTextWidth,children:n.value})]})};var M,H,O,B=t(79297),V=t(5169),L=t(79309),I=t(26503),Q=t(29857),W=t(37562);const $=(0,m.ZP)(w.RV)(M||(M=(0,i.Z)(["\n    user-select: none;\n    width: 100%;\n    margin-top: 12px;\n    margin-bottom: -4px;\n"]))),q=m.ZP.span(H||(H=(0,i.Z)(["\n    display: flex;\n    color: ",";\n\n    padding: 8px;\n    margin: -8px;\n"])),(e=>e.theme.iconSecondary)),K=m.ZP.span(O||(O=(0,i.Z)(["\n    display: inline-flex;\n    color: ",";\n"])),(e=>e.theme.accentBlue)),U=e=>{let{item:n,onSelect:t,onEdit:s}=e;const r=(0,x._H)(),{mutateAsync:i}=(e=>{const n=(0,x._H)(),t=(0,h.tN)(),s=(0,a.useQueryClient)();return(0,a.useMutation)((async()=>{await(0,V.T$)(n.storage,t.publicKey,e.address),await s.invalidateQueries([t.active.rawAddress,f.S8.activity,"suggestions"])}))})(n),{t:d}=(0,g.$)(),c=(0,W.R)(n);return(0,o.jsx)(I.HC,{onClick:()=>t(n),children:(0,o.jsxs)(I.me,{children:[(0,o.jsx)(S.Uc,{noWrap:!0,text:(0,o.jsxs)(o.Fragment,{children:[n.name," ",(0,o.jsx)(K,{children:(0,o.jsx)(C.r7,{})})]}),secondary:(0,l.FN)(c)}),(0,o.jsx)(L.vb,{payload:e=>(0,o.jsxs)(I.L8,{margin:!1,dropDown:!0,children:[(0,o.jsx)(I.HC,{dropDown:!0,onClick:t=>{t.stopPropagation(),s(n),e()},children:(0,o.jsx)(I.me,{children:(0,o.jsx)(w.RV,{children:d("add_edit_favorite_edit_title")})})}),(0,o.jsx)(I.HC,{dropDown:!0,onClick:t=>{t.stopPropagation(),r.confirm(d("send_screen_steps_address_delete_alert_text").replace("%{name}",n.name)).then((e=>{if(e)return i()})).finally((()=>{e()}))},children:(0,o.jsx)(I.me,{children:(0,o.jsx)(w.RV,{children:d("add_edit_favorite_delete")})})})]}),children:(0,o.jsx)(q,{children:(0,o.jsx)(C.ws,{})})})]})},n.address)},z=e=>{let{item:n,onSelect:t,onAddFavorite:s}=e;const{mutateAsync:r}=(e=>{const n=(0,x._H)(),t=(0,h.tN)(),s=(0,a.useQueryClient)();return(0,a.useMutation)((async()=>{await(0,V.nS)(n.storage,t.publicKey,e.address),await s.invalidateQueries([t.active.rawAddress,f.S8.activity,"suggestions"])}))})(n),{t:i,i18n:d}=(0,g.$)(),c=(0,W.R)(n);return(0,o.jsx)(I.HC,{onClick:()=>t(n),children:(0,o.jsxs)(I.me,{children:[(0,o.jsx)(S.Uc,{text:(0,l.FN)(c),secondary:(u=(0,B.l1)(d.language),m=n.timestamp,new Intl.DateTimeFormat((0,B.l1)(u),{day:"numeric",month:"long"}).format(new Date(m)))}),(0,o.jsx)(L.vb,{payload:e=>(0,o.jsxs)(I.L8,{margin:!1,dropDown:!0,children:[(0,o.jsx)(I.HC,{dropDown:!0,onClick:t=>{t.stopPropagation(),s(n),e()},children:(0,o.jsx)(I.me,{children:(0,o.jsx)(w.RV,{children:i("send_screen_steps_address_suggest_actions_add")})})}),(0,o.jsx)(I.HC,{dropDown:!0,onClick:n=>{n.stopPropagation(),r().finally((()=>e()))},children:(0,o.jsx)(I.me,{children:(0,o.jsx)(w.RV,{children:i("send_screen_steps_address_suggest_actions_hide")})})})]}),children:(0,o.jsx)(q,{children:(0,o.jsx)(C.ws,{})})})]})},n.address);var u,m},J=e=>{let{onSelect:n,disabled:t,acceptBlockchains:s}=e;const r=(0,x._H)(),{t:i}=(0,g.$)(),{data:d}=(e=>{const n=(0,x._H)(),{api:t}=(0,h.bp)(),s=(0,h.tN)();return(0,a.useQuery)([s.active.rawAddress,f.S8.activity,"suggestions",e],(()=>(0,V.hm)(n,t,s,e)),{keepPreviousData:!0})})(s);return d?(0,o.jsxs)(o.Fragment,{children:[d.length>0?(0,o.jsx)($,{children:i("send_screen_steps_address_suggests_label")}):void 0,(0,o.jsx)(I.L8,{margin:!1,fullWidth:!0,noUserSelect:!0,children:d.map((e=>e.isFavorite?(0,o.jsx)(U,{item:e,onSelect:e=>!t&&n(e),onEdit:e=>{t||r.uiEvents.emit("editSuggestion",{method:"editSuggestion",params:e})}},e.address):(0,o.jsx)(z,{item:e,onSelect:e=>!t&&n(e),onAddFavorite:e=>{t||r.uiEvents.emit("addSuggestion",{method:"addSuggestion",params:e})}},e.address)))})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)($,{children:i("send_screen_steps_address_suggests_label")}),(0,o.jsx)(Q.eM,{size:4,margin:!1,fullWidth:!0})]})};var G;const X=(0,m.ZP)(w.pN)(G||(G=(0,i.Z)(["\n    user-select: none;\n    display: block;\n    width: 100%;\n    margin-top: -4px;\n    color: ",";\n"])),(e=>e.theme.accentOrange)),Y=()=>{const{api:e}=(0,h.bp)();return(0,a.useMutation)((n=>{const t="dns"in n?n.dns.address:n.address;return new c.HOX(e.tonApiV2).getAccount({accountId:t})}))},ee=e=>{const{api:n}=(0,h.bp)(),[t,s]=(0,u.useState)("");return(0,u.useMemo)((()=>(0,l.Ds)((e=>s(e)),400)),[s])(e),(0,a.useQuery)([f.S8.dns,e,t],(async()=>{if(e!==t)return null;let s=t.trim();if((e=>e.length<8||48===e.length||52===e.length||(0,l.Ig)(e)||(0,l.nl)(e))(s))return null;s=s.toString().toLowerCase();const r=await new c.TuR(n.tonApiV2).dnsResolve({domainName:s});return r.wallet?r.wallet:null}),{retry:0,keepPreviousData:!1})},ne=e=>"dns"in e||(0,l.Ig)(e.address),te={address:""},se=e=>{var n;let{data:t,setRecipient:s,keyboard:r,onScan:i,isExternalLoading:m,acceptBlockchains:w,HeaderBlock:C,MainButton:k,fitContent:N,isAnimationProcess:Z}=e;const T=(0,x._H)(),[P,R]=(0,u.useState)(!1),D=(0,h.tN)(),{t:M}=(0,g.$)(),{standalone:H,ios:O}=(0,h.bp)(),B=(0,u.useRef)(null),V=(0,v.c)()&&Z,[L,I]=(0,u.useState)(t&&"comment"in t?t.comment:""),[Q,W]=(0,u.useState)(null!==(n=null===t||void 0===t?void 0:t.address)&&void 0!==n?n:te),{data:$,isFetching:q}=ee(Q.address);(0,u.useEffect)((()=>{const e=setTimeout((()=>(0,j.k3)()),300);return()=>{clearTimeout(e)}}),[]),(0,u.useEffect)((()=>{$&&W((e=>({address:e.address,dns:$,dnsName:e.address.toLowerCase()}))),null==$&&W((e=>"dns"in e?{address:e.address}:e))}),[W,$]);const K=(0,u.useMemo)((()=>{if(w&&1===w.length)return w[0];let e;return ne(Q)?e=d.S.TON:(0,l.nl)(Q.address)&&(e=d.S.TRON),!w||e&&w.includes(e)?e:null}),[Q]),U=(0,u.useMemo)((()=>!w||1!==w.length||(w[0]===d.S.TON?ne(Q):(0,l.nl)(Q.address))),[w,Q]),{data:z,isFetching:G}=((e,n)=>{const{api:t}=(0,h.bp)(),s="dns"in n?n.dns.address:n.address;return(0,a.useQuery)([f.S8.account,s],(()=>new c.HOX(t.tonApiV2).getAccount({accountId:s})),{enabled:e})})(K===d.S.TON&&ne(Q),Q),Y=G||m,se=(0,_.vO)(),re=(0,u.useMemo)((()=>se?/^[ -~]*$/gm.test(L):!z||(!z.memoRequired||L.length>0)),[z,L,se]);(0,u.useEffect)((()=>{T.isIOs()||B.current&&B.current.focus()}),[B.current]);const ie=(0,u.useMemo)((()=>"isFavorite"in Q?Q.blockchain===d.S.TRON?Q.address:(0,l.Tg)(Q.address,D.network):"dnsName"in Q&&"string"===typeof Q.dnsName?Q.dnsName:Q.address),[Q]),oe=((e,n,t)=>{var s;const r=(0,h.tN)(),i=null!==(s=null===t||void 0===t?void 0:t.address)&&void 0!==s?s:void 0,[o,a]=(0,u.useState)(void 0),d=(0,F.Z)({text:n,font:"16px sans-serif"}),c=(0,F.Z)({text:i?(0,l.FN)(i):void 0,font:"16px sans-serif"});return(0,u.useEffect)((()=>{e.current&&t&&!isNaN(d)&&!isNaN(c)&&e.current.clientWidth-48-d-c>0?a({inputTextWidth:d,addressTextWidth:c,value:(0,l.FN)((0,l.Tg)(t.address,r.network))}):a(void 0)}),[e.current,t,d,c]),o})(B,ie,z),ae=()=>{let e;switch(R(!0),K){case d.S.TON:e=re&&z;break;case d.S.TRON:e=(0,l.nl)(Q.address)}e?(O&&r&&(0,p.Q)(r),K===d.S.TON?s({address:{...Q,blockchain:d.S.TON},toAccount:z,comment:L,done:!0}):s({address:{...Q,blockchain:d.S.TRON},done:!0})):T.hapticNotification("error")};return(0,o.jsxs)(b.r4,{onSubmit:e=>{e.stopPropagation(),e.preventDefault(),ae()},standalone:H,fitContent:N,noPadding:!0,children:[!V&&(0,o.jsx)(b.JE,{children:(0,o.jsx)(b.O$,{children:(0,o.jsx)(C,{})})}),(0,o.jsx)(E,{value:oe,children:(0,o.jsx)(A,{onSubmit:ae,ref:B,value:ie,onScan:i,onChange:e=>W({address:e}),label:M("transaction_recipient_address"),isValid:!P||!!K&&U,disabled:m})}),K!==d.S.TRON&&(0,o.jsx)(y.Kx,{onSubmit:ae,value:L,onChange:I,label:M("txActions_signRaw_comment"),isValid:!P||re,disabled:m}),z&&z.memoRequired&&(0,o.jsx)(X,{children:M("send_screen_steps_comfirm_comment_required_text")}),(0,o.jsx)(J,{onSelect:async e=>{var n;e.blockchain===d.S.TON&&(e.address=(0,l.Tg)(e.address,D.network)),W(e),null===(n=B.current)||void 0===n||n.focus()},disabled:m,acceptBlockchains:w}),(0,o.jsx)(S.Zv,{}),!V&&(0,o.jsx)(b.gH,{children:(0,o.jsx)(b.B6,{children:(0,o.jsx)(k,{isLoading:Y||q,onClick:ae})})})]})}},81987:(e,n,t)=>{t.d(n,{Z:()=>o,m:()=>i});var s=t(72791);const r=()=>{const e=document.createDocumentFragment(),n=document.createElement("canvas");return e.appendChild(n),n.getContext("2d")},i=(e,n)=>{const t=r();if(t.font=n,Array.isArray(e))return Math.max(...e.map((e=>t.measureText(e).width)));return t.measureText(e).width},o=e=>{const n=(0,s.useMemo)((()=>"text"in e?e:void 0),[e]),t=(0,s.useMemo)((()=>"ref"in e?e:void 0),[e]);return(0,s.useMemo)((()=>{var e,s;if(null!==t&&void 0!==t&&null!==(e=t.ref.current)&&void 0!==e&&e.textContent){const e=r(),n=window.getComputedStyle(t.ref.current);e.font=n.font;return e.measureText(t.ref.current.textContent).width}return null!==n&&void 0!==n&&n.text?i(n.text,null!==(s=n.font)&&void 0!==s?s:"16px times"):NaN}),[null===n||void 0===n?void 0:n.text,null===n||void 0===n?void 0:n.font,null===t||void 0===t?void 0:t.ref])}},35281:(e,n,t)=>{t.d(n,{T:()=>r});var s=t(64572);class r extends Error{constructor(e,n){super(e),(0,s.Z)(this,"cause",void 0),this.name="UserCancelledError",this.cause=n}}}}]);
//# sourceMappingURL=754.f0b33cda.chunk.js.map